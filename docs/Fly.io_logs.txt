2025-04-14T09:56:03.276 app[6e822504c7e598] arn [info] Hämtar räknare "analysis_count" för användare: 0e2a314b-5870-4a90-be5a-5a7442ff57e9

2025-04-14T09:56:03.334 app[6e822504c7e598] arn [info] info: Health check endpoint accessed {"service":"koalens-backend","timestamp":"2025-04-14T09:56:03.334Z"}

2025-04-14T09:56:03.336 app[6e822504c7e598] arn [info] Hämtar räknare "analysis_count" för användare: 0e2a314b-5870-4a90-be5a-5a7442ff57e9

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] Räknarinformation hämtad: {

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] counter_id: 'b895ba21-4cc3-4d52-9ae6-e045ff078e0d',

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] user_id: '0e2a314b-5870-4a90-be5a-5a7442ff57e9',

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] value: 11,

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] limit: 15,

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] remaining: 4,

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] has_reached_limit: false,

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] last_reset: '2025-04-14T08:27:16.227634+00:00',

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] next_reset: '2025-05-14T08:27:16.227634+00:00'

2025-04-14T09:56:03.516 app[6e822504c7e598] arn [info] }

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] Räknarinformation hämtad: {

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] counter_id: 'b895ba21-4cc3-4d52-9ae6-e045ff078e0d',

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] user_id: '0e2a314b-5870-4a90-be5a-5a7442ff57e9',

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] value: 11,

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] limit: 15,

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] remaining: 4,

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] has_reached_limit: false,

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] last_reset: '2025-04-14T08:27:16.227634+00:00',

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] next_reset: '2025-05-14T08:27:16.227634+00:00'

2025-04-14T09:56:03.563 app[6e822504c7e598] arn [info] }

2025-04-14T09:56:03.903 app[6e822504c7e598] arn [info] Hämtar räknare "analysis_count" för användare: 0e2a314b-5870-4a90-be5a-5a7442ff57e9

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] Räknarinformation hämtad: {

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] counter_id: 'b895ba21-4cc3-4d52-9ae6-e045ff078e0d',

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] user_id: '0e2a314b-5870-4a90-be5a-5a7442ff57e9',

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] value: 11,

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] limit: 15,

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] remaining: 4,

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] has_reached_limit: false,

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] last_reset: '2025-04-14T08:27:16.227634+00:00',

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] next_reset: '2025-05-14T08:27:16.227634+00:00'

2025-04-14T09:56:03.942 app[6e822504c7e598] arn [info] }

2025-04-14T09:56:07.880 app[6e822504c7e598] arn [info] info: Request received at /video/analyze-video endpoint {"baseUrl":"/api/video","bodyKeys":["base64Data","mimeType","preferredLanguage"],"contentLength":"13853203","contentType":"application/json","hasBase64Data":true,"hasBody":true,"hasMimeType":true,"method":"POST","originalUrl":"/api/video/analyze-video","path":"/analyze-video","service":"koalens-backend","timestamp":"2025-04-14T09:56:07.879Z"}

2025-04-14T09:56:07.963 app[6e822504c7e598] arn [info] info: Video analysis request details {"bodyKeys":["base64Data","mimeType","preferredLanguage"],"bodySize":13853203,"hasBase64Data":true,"hasMimeType":true,"headers":{"accept":"application/json","content-length":"13853203","content-type":"application/json","user-agent":"okhttp/4.9.2"},"ip":"172.16.3.82","method":"POST","service":"koalens-backend","timestamp":"2025-04-14T09:56:07.958Z","url":"/api/video/analyze-video"}

2025-04-14T09:56:07.963 app[6e822504c7e598] arn [info] info: Video analysis request received {"dataSize":13853132,"endpoint":"/api/video/analyze-video","mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-14T09:56:07.959Z"}

2025-04-14T09:56:07.963 app[6e822504c7e598] arn [info] info: Video analysis request received {"dataSize":13853132,"hasApiKey":true,"mimeType":"video/quicktime","model":"gemini-2.0-flash","preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-04-14T09:56:07.959Z"}

2025-04-14T09:56:07.963 app[6e822504c7e598] arn [info] info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13853132,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-14T09:56:07.959Z"}

2025-04-14T09:56:07.990 app[6e822504c7e598] arn [info] info: Using aggressive video optimization for large video {"service":"koalens-backend","targetResolution":"240p","timestamp":"2025-04-14T09:56:07.990Z","videoSizeMB":9.90853214263916}

2025-04-14T09:56:07.990 app[6e822504c7e598] arn [info] info: Using FAST optimization method for medium video {"service":"koalens-backend","timestamp":"2025-04-14T09:56:07.990Z","videoSizeMB":9.90853214263916}

2025-04-14T09:56:09.689 app[6e822504c7e598] arn [info] info: Fast video optimization completed {"compressionRatio":"48.35","method":"fast","optimizedSizeMB":"0.20","originalSizeMB":"9.91","service":"koalens-backend","timestamp":"2025-04-14T09:56:09.689Z"}

2025-04-14T09:56:09.689 app[6e822504c7e598] arn [info] info: Video optimization completed {"compressionRatio":"48.35","optimizedSizeMB":"0.20","originalSizeMB":"9.91","service":"koalens-backend","timestamp":"2025-04-14T09:56:09.689Z"}

2025-04-14T09:56:09.690 app[6e822504c7e598] arn [info] info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":3072,"temperature":0.2,"topK":40,"topP":0.8},"mediaSizeBytes":214869,"mediaType":"video/quicktime","prompt":"Analysera ingredienserna i videon. Använd ALLTID funktionen 'recordIngredientAnalysis' för att rapportera resultatet. Svara INTE med vanlig text, anropa endast funktionen. Alla ingrediensnamn i svaret, speciellt i fältet 'translated_name', MÅSTE vara på svenska. Analysera på svenska.","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-14T09:56:09.690Z","toolsProvided":true}

2025-04-14T09:56:11.752 app[6e822504c7e598] arn [info] info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":71,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-14T09:56:11.752Z"}

2025-04-14T09:56:11.753 app[6e822504c7e598] arn [info] info: Raw result object from geminiService.generateContentFromVideo: {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.753Z"}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] info: Raw result.response object: {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.753Z"}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] info: Raw result.response.functionCalls object: {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.753Z"}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] info: Gemini API call completed {"geminiApiCallMs":2063,"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.753Z","totalElapsedMs":3794}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] info: Successfully extracted 1 function call from response.candidates path. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.753Z"}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] info: Raw validated AI function call arguments (validatedArgs): {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.754Z"}

2025-04-14T09:56:11.754 app[6e822504c7e598] arn [info] warn: [Enhance Loop No Match] No DB match for: "palmolja". Keeping AI status. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.755Z"}

2025-04-14T09:56:11.755 app[6e822504c7e598] arn [info] warn: [Enhance Loop No Match] No DB match for: "vetemjöl". Keeping AI status. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.755Z"}

2025-04-14T09:56:11.758 app[6e822504c7e598] arn [info] warn: [Enhance Loop No Match] No DB match for: "senap". Keeping AI status. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.758Z"}

2025-04-14T09:56:11.759 app[6e822504c7e598] arn [info] warn: [Enhance Loop No Match] No DB match for: "jäst". Keeping AI status. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.759Z"}

2025-04-14T09:56:11.759 app[6e822504c7e598] arn [info] warn: [Enhance Loop No Match] No DB match for: "mjölk". Keeping AI status. {"service":"koalens-backend","timestamp":"2025-04-14T09:56:11.760Z"}

2025-04-14T09:56:11.760 app[6e822504c7e598] arn [info] info: Successfully enhanced analysis result {"confidence":0.5,"ingredientCount":6,"isUncertain":true,"isVegan":false,"nonVeganIngredients":["mjölk"],"reasoning":"Produkt analyserad: icke-vegan. Status är osäker.","service":"koalens-backend","timestamp":"2025-04-14T09:56:11.760Z","uncertainIngredients":["arom"],"uncertainReasons":["Status är osäker"],"videoProcessed":true}

2025-04-14T09:56:11.760 app[6e822504c7e598] arn [info] info: Video analysis completed by service {"ingredientCount":6,"isUncertain":true,"isVegan":false,"processingTimeSec":"3.88","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-14T09:56:11.760Z"}

2025-04-14T09:56:11.760 app[6e822504c7e598] arn [info] info: Sending analysis response to client {"confidence":0.5,"ingredientCount":6,"isUncertain":true,"isVegan":false,"nonVeganCount":1,"problemIngredient":"mjölk","responseData":"{\"success\":true,\"result\":{\"success\":true,\"status\":\"non-vegan\",\"isVegan\":false,\"isUncertain\":true,\"confidence\":0.5,\"ingredientList\":[{\"name\":\"palmolja\",\"status\":\"vegan\",\"statusColor\":\"#90EE90\",\"description\":\"Ingrediensen \\\"palmolja\\\" är vegansk.\"},{\"name\":\"vetemjöl\",\"status\":\"vegan\",\"statusColor\":\"#90EE90\",\"description\":\"Ingrediensen \\\"vetemjöl\\\" är vegansk.\"},{\"name\":\"senap\",\"status\":\"vegan\",\"statusColor\":\"#90EE90\",\"description\":\"Ingrediensen \\\"senap\\\" är vegansk.\"},{\"name\":\"jäst\",\"status\":\"vegan\",\"statusColor\":\"#90EE90\",\"description\":\"Ingrediensen \\\"jäst\\\" är vegansk.\"},{\"name\":\"arom\",\"status\":\"uncertain\",\"statusColor\":\"#FFBF00\",\"description\":\"Ingrediensen \\\"arom\\\" kan vara vegansk eller icke-vegansk.\"},{\"name\":\"mjölk\",\"status\":\"non-vegan\",\"statusColor\":\"#FF6347\",\"description\":\"Ingrediensen \\\"mjölk\\\" är inte vegansk.\"}],\"watchedIngredients\":[{\"name\":\"arom\",\"status\":\"uncertain\",\"statusColor\":\"#FFBF00\",\"reason\":\"Potentiellt icke-vegansk\",\"description\":\"Denna ingrediens kan vara antingen växt- eller djurbaserad.\"},{\"name\":\"mjölk\",\"status\":\"non-vegan\",\"statusColor\":\"#FF6347\",\"reason\":\"Icke-vegansk\",\"description\":\"Denna ingrediens är av animaliskt ursprung.\"}],\"veganIngredients\":[\"palmolja\",\"vetemjöl\",\"senap\",\"jäst\"],\"nonVeganIngredients\":[\"mjölk\"],\"uncertainIngredients\":[\"arom\"],\"problemIngredient\":\"mjölk\",\"uncertainReasons\":[\"Status är osäker\"],\"reasoning\":\"Produkt analyserad: icke-vegan. Status är osäker.\",\"usageInfo\":{\"analysesUsed\":0,\"analysesLimit\":10,\"remaining\":10,\"isPremium\":false}}}","service":"koalens-backend","status":"non-vegan","timestamp":"2025-04-14T09:56:11.761Z","uncertainCount":1,"veganCount":4}

2025-04-14T09:56:11.978 app[6e822504c7e598] arn [info] Ökar räknare "analysis_count" för användare: 0e2a314b-5870-4a90-be5a-5a7442ff57e9

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] Räknare ökad: {

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] limit: 15,

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] value: 12,

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] user_id: '0e2a314b-5870-4a90-be5a-5a7442ff57e9',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] remaining: 3,

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] counter_id: 'b895ba21-4cc3-4d52-9ae6-e045ff078e0d',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] last_reset: '2025-04-14T08:27:16.227634+00:00',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] next_reset: '2025-05-14T08:27:16.227634+00:00',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] has_reached_limit: false

2025-04-14T09:56:12.043 app[6e822504c7e598] arn [info] }

2025-04-14T09:56:12.626 app[6e822504c7e598] arn [info] Hämtar räknare "analysis_count" för användare: 0e2a314b-5870-4a90-be5a-5a7442ff57e9

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] Räknarinformation hämtad: {

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] counter_id: 'b895ba21-4cc3-4d52-9ae6-e045ff078e0d',

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] user_id: '0e2a314b-5870-4a90-be5a-5a7442ff57e9',

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] value: 12,

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] limit: 15,

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] remaining: 3,

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] has_reached_limit: false,

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] last_reset: '2025-04-14T08:27:16.227634+00:00',

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] next_reset: '2025-05-14T08:27:16.227634+00:00'

2025-04-14T09:56:12.721 app[6e822504c7e598] arn [info] }

2025-04-14T09:56:15.994 app[6e822504c7e598] arn [info] warn: Video optimization timed out, using original video {"service":"koalens-backend","timestamp":"2025-04-14T09:56:15.994Z"}